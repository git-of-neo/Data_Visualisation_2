{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "width":"container",
  "data": {
    "url":"data/world-happiness-report-2021.csv"
  },
  "transform": [
    {"calculate": "datum['Ladder score'] - 5.532838926174494", "as": "score_deviation"}
  ],
  "layer": [
    {
      "transform": [
        {"window": 
          [{"op":"rank", "as": "rank"}], 
          "sort": [{"field": "score_deviation","order":"descending"}]
        },
        {"filter":"datum.rank <= 5"}
      ],
      "mark":"bar",
      "encoding": {
        "y":{"field":"rank"},
        "x":{
          "aggregate":"sum",
          "field":"score_deviation"
        },
        "color":{
          "legend":null,
          "scale":{"range":["#c1181b","#e13128","#f6573f","#fb7f60","#fca589","#b2e0ac","#8ccf8a","#60ba6c","#39a055","#1a833e"]}, 
          "field":"score_deviation"
        },
        "tooltip":[
          {"field":"Ladder score"},
          {"field":"Country name"},
          {"field":"score_deviation", "title":"Deviation from global average", "format":".2f"}
        ]
      }
    },
    {
      "transform": [
        {"window": 
          [{"op":"rank", "as": "rank"}], 
          "sort": [{"field": "score_deviation","order":"ascending"}]
        },
        {"filter":"datum.rank <= 5"}
      ],
      "mark":"bar",
      "encoding": {
        "y":{"field":"rank"},
        "x":{
          "aggregate":"sum",
          "field":"score_deviation"
        },
        "color":{"field":"score_deviation"},
        "tooltip":[
          {"field":"Ladder score"},
          {"field":"Country name"},
          {"field":"score_deviation", "title":"Deviation from global average", "format":".2f"}
        ]
      }
    }
  ],
  "config": {
    "view": {"stroke":null},
    "axis": {"grid": false, "labels": false}
  }
}