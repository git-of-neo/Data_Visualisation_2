{
  "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
  "width":"container",
  "data": {
    "url":"data/world-happiness-report-2021.csv"
  },
  "layer": [
    {
      "transform": [
        {
          "window": 
          [{"op":"rank", "as": "rank"}], 
          "sort": [{"field": "Ladder score","order":"descending"}]
        },
        {"filter":"datum.rank >= 144"}
      ],
      "encoding": {
        "y":{"field":"rank"},
        "x":{
          "aggregate":"sum",
          "field":"Ladder score"
        },
        "color":{
          "legend":null,
          "scale":{"scheme":"reds"}, 
          "field":"Ladder score"
        },
        "tooltip":[
          {"field":"Ladder score"},
          {"field":"Country name"},
          {"field":"score_deviation", "title":"Deviation from global average", "format":".2f"}
        ]
      },
      "layer": [
        {
          "mark":"bar"
        },
        {
          "mark":{
            "type": "text",
            "align":"left",
            "dx":3
          },
          "encoding": {
            "text":{
              "field":"Ladder score", 
              "format":".2f"}
          }
        },
        {
          "mark":{
            "type": "text",
            "align":"left",
            "dx":10
          },
          "encoding": {
            "x":{"datum":0},
            "text":{"field":"Country name"},
            "color":{"value":"white"}
          }
        }
      ]
    }
  ],
  "config": {
    "view": {"stroke":null},
    "axis": {"disable": true}
  }
}